<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sheet Activity Monitor</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; padding: 20px; margin: 0; }
        h1 { text-align: center; color: #1a1a1a; margin-bottom: 20px; }
        .refresh-btn { display: block; margin: 0 auto 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 20px; cursor: pointer; }
        .grid { display: flex; flex-direction: column; gap: 10px; max-width: 600px; margin: 0 auto; }
        
        /* Updated Card CSS to act as a link */
        .card { 
            background: white; 
            padding: 15px 20px; 
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            
            /* LINK STYLING RESET */
            text-decoration: none; /* Removes underline */
            color: inherit;        /* Keeps text black/grey */
            transition: transform 0.2s, box-shadow 0.2s;
        }

        /* Add a "Clickable" feel */
        .card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .card:active {
            transform: scale(0.98);
        }
        
        .sheet-info { text-align: left; }
        .sheet-name { font-weight: 600; font-size: 1.1em; display: block; color: #333; }
        .timestamp { font-size: 0.85em; color: #666; margin-top: 4px; display: block;}
        
        /* Status Badges */
        .badge { font-size: 0.75em; padding: 4px 8px; border-radius: 12px; font-weight: bold; }
        .badge-recent { background: #e6fffa; color: #00b894; } /* Edited < 1 hour ago */
        .badge-today { background: #fff8e1; color: #f39c12; }  /* Edited today */
        .badge-old { background: #f1f2f6; color: #b2bec3; }    /* Old */

    </style>
</head>
<body>

    <h1>Sheet Activity</h1>
    <button class="refresh-btn" onclick="fetchData()">Refresh Data</button>
    <div id="dashboard" class="grid">
        <p style="text-align:center;">Loading...</p>
    </div>

    <script>
        // ⚠️ PASTE YOUR GOOGLE SCRIPT WEB APP URL HERE ⚠️
        const API_URL = 'https://script.google.com/macros/s/AKfycbx3MgS3mfEs4naEfVXUfjd7jsRljF6Oy6eIFp5V66e_sKVULy6_benmNhDywsB2SFFR/exec';

        async function fetchData() {
            const container = document.getElementById('dashboard');
            container.innerHTML = '<p style="text-align:center;">Updating...</p>';

            try {
                const response = await fetch(API_URL);
                let data = await response.json();
                
                // Sort Data: Newest dates first
                data.sort((a, b) => {
                    if (!a.lastEdited) return 1;
                    if (!b.lastEdited) return -1;
                    return new Date(b.lastEdited) - new Date(a.lastEdited);
                });

                renderDashboard(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                container.innerHTML = '<p>Error connecting to sheet. Make sure the API is deployed as "Anyone".</p>';
            }
        }

        function renderDashboard(sheets) {
            const container = document.getElementById('dashboard');
            container.innerHTML = '';
            
            sheets.forEach(sheet => {
                const timeString = sheet.lastEdited ? new Date(sheet.lastEdited).toLocaleString() : "No recent edits";
                const timeAgo = sheet.lastEdited ? getTimeAgo(new Date(sheet.lastEdited)) : "Never";
                
                let badgeClass = 'badge-old';
                let badgeText = timeAgo;
                
                if (sheet.lastEdited) {
                    const diffHours = (new Date() - new Date(sheet.lastEdited)) / 36e5;
                    if (diffHours < 1) {
                         badgeClass = 'badge-recent'; 
                    } else if (diffHours < 24) {
                         badgeClass = 'badge-today'; 
                    }
                }

                // CHANGED: Creating an anchor (a) tag for direct linking
                const card = document.createElement('a'); 
                card.className = 'card';
                card.href = sheet.url; // Uses the full URL with GID from Apps Script
                card.target = "_blank"; // Opens in new tab/app
                
                card.innerHTML = `
                    <div class="sheet-info">
                        <span class="sheet-name">${sheet.name}</span>
                        <span class="timestamp">${timeString}</span>
                    </div>
                    <div class="${badgeClass} badge">
                        ${badgeText}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Helper: Convert date to relative time ("X minutes ago")
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hrs ago";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " mins ago";
            return "Just now";
        }

        fetchData();
        
        // Register Service Worker for PWA (assuming sw.js exists)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
</body>
</html>
